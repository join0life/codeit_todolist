import CreateTodoInput from "@/components/todo/create-todo-input";
import TodoList from "@/components/todo/todo-list";
import TodoEmpty from "@/components/empty/todo-empty";
import DoneEmpty from "@/components/empty/done-empty";
import { Metadata } from "next";
import { fetchTodo } from "./actions/todo-actions";
import { Suspense } from "react";
import Loader from "@/components/loader";

export const dynamic = "force-dynamic";

export const metadata: Metadata = {
  title: "투두리스트",
  description: "코드잇 과제 - 투두리스트",
  openGraph: {
    title: "투두리스트",
    description: "코드잇 과제 - 투두리스트",
  },
};

async function TodoAll() {
  const data = await fetchTodo();
  const isEmpty = data.length === 0;

  const todoList = data.filter((item) => !item.isCompleted);
  const doneList = data.filter((item) => item.isCompleted);

  return (
    <div className="mx-auto max-w-300 p-4 sm:p-6 xl:p-6">
      <div className="flex flex-col gap-10">
        {/** 할 일 추가 섹션 */}
        <section className="flex w-full items-center justify-center gap-2 sm:gap-4 xl:gap-4">
          <CreateTodoInput isEmpty={isEmpty} />
        </section>

        <section className="flex flex-col gap-6 md:flex-row">
          {/** TODO 목록 */}
          <div className="flex w-full flex-col gap-4 md:w-1/2">
            <svg
              width="101"
              height="36"
              viewBox="0 0 101 36"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect width="101" height="36" rx="18" fill="#BEF264" />
              <path
                d="M36.0587 13.47V15.666L32.9447 15.882V23.478C32.9447 23.778 32.8367 24.036 32.6207 24.252C32.4167 24.468 32.1587 24.576 31.8467 24.576H30.3167V16.098L27.4547 16.296V14.28L36.0587 13.47ZM41.7751 22.596C42.5551 22.596 43.1911 22.29 43.6831 21.678C44.1871 21.066 44.4391 20.178 44.4391 19.014C44.4391 17.934 44.2231 17.118 43.7911 16.566C43.3591 16.002 42.8011 15.72 42.1171 15.72C41.3251 15.72 40.6711 16.026 40.1551 16.638C39.6391 17.25 39.3811 18.138 39.3811 19.302C39.3811 20.382 39.6031 21.204 40.0471 21.768C40.4911 22.32 41.0671 22.596 41.7751 22.596ZM36.9511 19.446C36.9511 18.27 37.1611 17.256 37.5811 16.404C38.0131 15.552 38.5951 14.886 39.3271 14.406C40.0711 13.914 40.9111 13.614 41.8471 13.506C42.1591 13.482 42.3931 13.47 42.5491 13.47C43.4491 13.47 44.2531 13.668 44.9611 14.064C45.6811 14.46 46.2451 15.06 46.6531 15.864C47.0731 16.668 47.2831 17.664 47.2831 18.852C47.2831 20.136 47.0371 21.228 46.5451 22.128C46.0651 23.028 45.4111 23.7 44.5831 24.144C43.7671 24.588 42.8551 24.81 41.8471 24.81C40.9111 24.81 40.0711 24.606 39.3271 24.198C38.5951 23.802 38.0131 23.202 37.5811 22.398C37.1611 21.594 36.9511 20.61 36.9511 19.446ZM56.0489 22.434C56.6129 22.41 57.1049 22.236 57.5249 21.912C57.9569 21.576 58.2869 21.132 58.5149 20.58C58.7429 20.028 58.8569 19.428 58.8569 18.78C58.8569 17.856 58.6409 17.106 58.2089 16.53C57.7769 15.942 57.1949 15.648 56.4629 15.648C56.3789 15.648 56.2409 15.66 56.0489 15.684L54.6449 15.918V22.488L56.0489 22.434ZM52.3229 14.28L56.0489 13.524C56.3249 13.464 56.6429 13.434 57.0029 13.434C57.8309 13.434 58.5929 13.65 59.2889 14.082C59.9969 14.514 60.5549 15.114 60.9629 15.882C61.3829 16.65 61.5929 17.52 61.5929 18.492C61.5929 19.596 61.3349 20.616 60.8189 21.552C60.3029 22.488 59.6189 23.232 58.7669 23.784C57.9149 24.324 57.0089 24.594 56.0489 24.594H53.5829C53.2349 24.594 52.9349 24.468 52.6829 24.216C52.4429 23.976 52.3229 23.682 52.3229 23.334V14.28ZM67.8611 22.596C68.6411 22.596 69.2771 22.29 69.7691 21.678C70.2731 21.066 70.5251 20.178 70.5251 19.014C70.5251 17.934 70.3091 17.118 69.8771 16.566C69.4451 16.002 68.8871 15.72 68.2031 15.72C67.4111 15.72 66.7571 16.026 66.2411 16.638C65.7251 17.25 65.4671 18.138 65.4671 19.302C65.4671 20.382 65.6891 21.204 66.1331 21.768C66.5771 22.32 67.1531 22.596 67.8611 22.596ZM63.0371 19.446C63.0371 18.27 63.2471 17.256 63.6671 16.404C64.0991 15.552 64.6811 14.886 65.4131 14.406C66.1571 13.914 66.9971 13.614 67.9331 13.506C68.2451 13.482 68.4791 13.47 68.6351 13.47C69.5351 13.47 70.3391 13.668 71.0471 14.064C71.7671 14.46 72.3311 15.06 72.7391 15.864C73.1591 16.668 73.3691 17.664 73.3691 18.852C73.3691 20.136 73.1231 21.228 72.6311 22.128C72.1511 23.028 71.4971 23.7 70.6691 24.144C69.8531 24.588 68.9411 24.81 67.9331 24.81C66.9971 24.81 66.1571 24.606 65.4131 24.198C64.6811 23.802 64.0991 23.202 63.6671 22.398C63.2471 21.594 63.0371 20.61 63.0371 19.446Z"
                fill="#15803D"
              />
            </svg>
            <TodoList data={todoList} empty={<TodoEmpty />} />
          </div>

          {/** DONE 목록 */}
          <div className="flex w-full flex-col gap-4 md:w-1/2">
            <svg
              width="97"
              height="36"
              viewBox="0 0 97 36"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect width="97" height="36" rx="18" fill="#15803D" />
              <path
                d="M31.751 22.434C32.315 22.41 32.807 22.236 33.227 21.912C33.659 21.576 33.989 21.132 34.217 20.58C34.445 20.028 34.559 19.428 34.559 18.78C34.559 17.856 34.343 17.106 33.911 16.53C33.479 15.942 32.897 15.648 32.165 15.648C32.081 15.648 31.943 15.66 31.751 15.684L30.347 15.918V22.488L31.751 22.434ZM28.025 14.28L31.751 13.524C32.027 13.464 32.345 13.434 32.705 13.434C33.533 13.434 34.295 13.65 34.991 14.082C35.699 14.514 36.257 15.114 36.665 15.882C37.085 16.65 37.295 17.52 37.295 18.492C37.295 19.596 37.037 20.616 36.521 21.552C36.005 22.488 35.321 23.232 34.469 23.784C33.617 24.324 32.711 24.594 31.751 24.594H29.285C28.937 24.594 28.637 24.468 28.385 24.216C28.145 23.976 28.025 23.682 28.025 23.334V14.28ZM43.5632 22.596C44.3432 22.596 44.9792 22.29 45.4712 21.678C45.9752 21.066 46.2272 20.178 46.2272 19.014C46.2272 17.934 46.0112 17.118 45.5792 16.566C45.1472 16.002 44.5892 15.72 43.9052 15.72C43.1132 15.72 42.4592 16.026 41.9432 16.638C41.4272 17.25 41.1692 18.138 41.1692 19.302C41.1692 20.382 41.3912 21.204 41.8352 21.768C42.2792 22.32 42.8552 22.596 43.5632 22.596ZM38.7392 19.446C38.7392 18.27 38.9492 17.256 39.3692 16.404C39.8012 15.552 40.3832 14.886 41.1152 14.406C41.8592 13.914 42.6992 13.614 43.6352 13.506C43.9472 13.482 44.1812 13.47 44.3372 13.47C45.2372 13.47 46.0412 13.668 46.7492 14.064C47.4692 14.46 48.0332 15.06 48.4412 15.864C48.8612 16.668 49.0712 17.664 49.0712 18.852C49.0712 20.136 48.8252 21.228 48.3332 22.128C47.8532 23.028 47.1992 23.7 46.3712 24.144C45.5552 24.588 44.6432 24.81 43.6352 24.81C42.6992 24.81 41.8592 24.606 41.1152 24.198C40.3832 23.802 39.8012 23.202 39.3692 22.398C38.9492 21.594 38.7392 20.61 38.7392 19.446ZM56.7534 14.748C56.7534 14.436 56.8554 14.16 57.0594 13.92C57.2754 13.68 57.5394 13.548 57.8514 13.524L59.5434 13.344V24.594H56.7174L52.9734 18.384V24.594H50.5074V14.28L52.9734 14.028L56.7534 20.13V14.748ZM63.7835 18.006L68.3735 17.592V19.824L63.7835 20.094V22.506L68.9675 22.362V23.46C68.9675 23.772 68.8595 24.036 68.6435 24.252C68.4275 24.48 68.1635 24.594 67.8515 24.594H61.3355V14.28L68.9675 13.164V15.414L63.7835 16.008V18.006Z"
                fill="#FCD34D"
              />
            </svg>
            <TodoList data={doneList} empty={<DoneEmpty />} />
          </div>
        </section>
      </div>
    </div>
  );
}

export default async function Home() {
  return (
    <Suspense fallback={<Loader />}>
      <TodoAll />
    </Suspense>
  );
}
